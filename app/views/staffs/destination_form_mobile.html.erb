<!-- 参集場所報告画面（モバイル） -->

<% if params[:notice] %>
  <div id="flash" style="color: green; border: green solid">
    <%= params[:notice] %>
  </div>
<% end %>

<%= form_tag :action => 'save_destination' do %>

  <%= hidden_field_tag "disaster_code", @disaster_code %>
  <%= hidden_field_tag "agent_id", @agent_id %>
  <%= hidden_field_tag "latitude", @latitude %>
  <%= hidden_field_tag "longitude", @longitude %>

  <p>参集場所（これから向かう場所）を選択してください。</p>

  <% if @gathering_positions["#{@predefined_position}"] %>
    <% count = 2 %>
    <p>▼所定の参集場所</p>
    <p><%= radio_button "destination", "position", "#{@predefined_position}" %>(1) <%= @gathering_positions["#{@predefined_position}"]["name"] %></p>
  <% else %>
    <% count = 1 %>
  <% end %>

  <p>▼近くの参集場所</p>
  <% @near_gathering_positions.each do |id, gathering_position| %>
    <p><%= radio_button "destination", "position", "#{id.to_i}" %><%="(#{count}) #{gathering_position["name"]}"%></p>
    <% count += 1 %>
  <% end %>

  <img src="http://maps.google.com/maps/api/staticmap?center=38.4344802,141.3029167
&zoom=<%= @zoom %>&size=200x200&sensor=false
&markers=<%= @latitude %>,<%= @longitude %>
<% if @gathering_positions["#{@predefined_position}"] %>
  <%= "&markers=label:1|#{@gathering_positions["#{@predefined_position}"]["latitude"]},#{@gathering_positions["#{@predefined_position}"]["longitude"]}".html_safe %>
  <% count = 2 %>
<% else %>
  <% count = 1 %>
<% end %>
<% @near_gathering_positions.each do |id, gathering_position| %>
  <%= "&markers=label:#{count}|#{gathering_position['latitude']},#{gathering_position['longitude']}".html_safe %>
  <% count += 1 %>
<% end %>
">

  <p>▼参集場所に向かうのが困難</p>

  <p><%= check_box "destination", "place" %>理由を入力して下さい。</p>
  <p><%= text_field :destination, :reason %></p>

  <p>備考を入力してください</p>
  <p><%= text_field :destination, :note, :size => '30', :maxlength => '20' %></p>

  <%= submit_tag "送信" %>

<% end %>
